---
description: 统一 Swift 代码注释规范，关键部分必须添加清晰的中文注释
globs: *.swift
alwaysApply: false
alwaysApplyLiterals: false
---
# Swift 代码注释规范

本规则确保 Swift 代码的关键部分都有清晰、准确的中文注释，提升代码可读性和可维护性。

## 基本原则

1. **注释优先级**：关键逻辑必须注释，简单代码无需过度注释
2. **使用文档注释**：使用 `///` 而非 `//`，以便 Xcode 可以识别并显示 Quick Help
3. **中文注释**：使用中文编写注释，确保团队理解一致
4. **简洁准确**：注释应该说明"为什么"和"是什么"，而非重复代码

## 必须注释的位置

### 1. 类型定义

每个 `struct`、`class`、`enum` 都必须有文档注释：

```swift
/// 显示远程仓库同步状态的视图组件
/// 显示本地领先远程和远程领先本地的提交数量，并提供手动刷新功能
struct RemoteSyncStatusView: View, SuperLog {
    // ...
}
```

### 2. 属性声明

所有 `@State`、`@Binding`、`@EnvironmentObject`、`@Published` 等属性包装器必须注释：

```swift
/// 是否启用详细日志输出
static let verbose = true

/// 环境对象：数据提供者
@EnvironmentObject var data: DataProvider

/// 未推送的提交数量（本地领先远程）
@State private var unpushedCount = 0

/// 是否正在加载同步状态
@State private var isLoading = false
```

属性注释应该说明：

- 数据的含义
- 数据的用途
- 必要时说明数据范围或约束

### 3. 计算属性

所有计算属性必须注释，说明其计算逻辑或业务含义：

```swift
/// 是否有需要显示的同步状态
private var hasSyncStatus: Bool {
    unpushedCount > 0 || unpulledCount > 0
}
```

### 4. 函数和方法

所有函数和方法必须有文档注释，包括：

**私有方法：**

```swift
/// 加载同步状态：获取未推送和未拉取的提交数量
private func loadSyncStatus() {
    // ...
}
```

**公开方法：**

```swift
/// 执行 git pull 操作拉取远程提交
/// - Parameter force: 是否强制拉取
/// - Returns: 拉取是否成功
func pull(force: Bool = false) async throws -> Bool {
    // ...
}
```

方法注释应该说明：

- 方法的功能
- 参数说明（如果有）
- 返回值说明（如果有）
- 可能抛出的异常（如果有）

### 5. MARK 分组

每个 `// MARK:` 都应该有简短的说明：

```swift
// MARK: - View
// MARK: - Action
// MARK: - Event Handler
// MARK: - Preview
```

### 6. 复杂逻辑

对于复杂的业务逻辑或算法，需要添加行内注释：

```swift
Task {
    await MainActor.run { isLoading = true }

    do {
        let unpushed = try project.getUnPushedCommits()
        await MainActor.run {
            self.unpushedCount = unpushed.count
        }
    } catch {
        await MainActor.run {
            self.unpushedCount = 0
            os_log(.error, "\(self.t)❌ Failed to load unpushed commits count: \(error)")
        }
    }

    // 2秒后自动隐藏提示文字
    try? await Task.sleep(nanoseconds: 2_000_000_000)
    await MainActor.run {
        statusMessage = nil
    }
}
```

### 7. UI 组件

SwiftUI 视图的子组件必须有注释：

```swift
/// 同步状态指示器容器：显示未推送和未拉取的提交数量
private var syncStatusIndicators: some View {
    // ...
}

/// 未推送提交指示器：橙色向上箭头 + 数量（可点击执行 push）
private var unpushedIndicator: some View {
    // ...
}

/// 刷新按钮：点击时重新加载同步状态，支持旋转动画
private var refreshButton: some View {
    // ...
}
```

## 注释风格

### 使用三斜线 `///`

对于文档注释，使用 `///` 而非 `//`：

```swift
/// 这样可以
var count = 0

// 而不是这样
var count = 0
```

### 注释位置

注释应该位于被注释对象的**上方**，而非右侧：

```swift
/// 推荐：注释在上方
@State private var isLoading = false

/// 不推荐：注释在右侧
@State private var isLoading = false /// 加载状态
```

### 使用表情符号（可选）

在合适的情况下可以使用表情符号增强可读性，但不要过度使用：

```swift
/// 日志标识符
static let emoji = "🔄"

os_log(.error, "\(self.t)❌ Failed to load unpushed commits count: \(error)")
os_log("\(self.t)✅ Git pull succeeded")
```

## 无需注释的情况

以下情况**无需**注释：

1. **显而易见的代码**：

    ```swift
    // ❌ 不需要这样的注释
    let count = items.count  // 获取数量

    // ✅ 直接写
    let count = items.count
    ```

2. **标准的初始化或生命周期方法**：

    ```swift
    // ❌ 不需要注释
    func onAppear() {
        loadSyncStatus()
    }

    // ✅ 如果方法名已经足够表达，可以不注释
    ```

3. **重复类型信息**：

```swift
// ❌ 不要重复类型信息
/// 这是一个字符串变量
var name: String

// ✅ 应该说明用途
/// 用户的显示名称
var name: String
```

## 完整示例

```swift
import SwiftUI

/// 显示远程仓库同步状态的视图组件
/// 显示本地领先远程和远程领先本地的提交数量，并提供手动刷新功能
struct RemoteSyncStatusView: View, SuperLog {
    /// 是否启用详细日志输出
    static let verbose = true

    /// 环境对象：数据提供者
    @EnvironmentObject var data: DataProvider

    /// 未推送的提交数量（本地领先远程）
    @State private var unpushedCount = 0

    /// 未拉取的提交数量（远程领先本地）
    @State private var unpulledCount = 0

    /// 是否正在加载同步状态
    @State private var isLoading = false

    /// 是否有需要显示的同步状态
    private var hasSyncStatus: Bool {
        unpushedCount > 0 || unpulledCount > 0
    }

    var body: some View {
        // ...
    }
}

// MARK: - View

extension RemoteSyncStatusView {
    /// 同步状态指示器容器
    private var syncStatusIndicators: some View {
        // ...
    }
}

// MARK: - Action

extension RemoteSyncStatusView {
    /// 加载同步状态：获取未推送和未拉取的提交数量
    private func loadSyncStatus() {
        // ...
    }

    /// 执行 git pull 操作拉取远程提交
    private func performPull() {
        // ...
    }
}

// MARK: - Event

extension RemoteSyncStatusView {
    /// 视图出现时的事件处理
    func onAppear() {
        loadSyncStatus()
    }
}
```

## 注意事项

1. **保持注释同步**：代码修改时，务必同步更新相关注释
2. **避免误导性注释**：宁可不注释，也不要写错误的注释
3. **注释应该有价值**：如果注释只是重复代码，考虑删除
4. **中文规范**：使用规范的中文，避免口语化和错别字
5. **技术术语**：技术术语可以保持英文（如 git push、async/await）
